- content_for :title, "Gebruiker #{@user.name}- SOFIA"

- content_for :modal
  = render 'mutation_modal'

= content_tag :div, id: 'user-container', class: ' container footer-padding', data: { user: @user_json }
  template v-if="bubblesActivated"
    bubbles
    audio autoplay="true"
      source src="/wemakenschoon.mp3" type="audio/mpeg"

  audio v-if="soundActivated" id="bubblesound" loop=""
    source src="/bubbles.mp3" type="audio/mpeg"

  .row.justify-content-between
    .col-sm-12.col-md-6.py-2

      h1.mouse-pointer @click="toggleBubbles"
        span.mr-2
          = fa_icon 'bath', class: 'mr-2', 'v-if': 'bubblesActivated'
          = fa_icon 'user', class: 'mr-2', 'v-else': true

        = '{{user.name}}'

        = fa_icon 'trophy', class: 'ml-2', 'v-if': 'bubblesActivated'

      table.table.table-sm
        tbody
          - if @user.birthday
            tr
              th scope='row' = 'Geboortedatum'
              td.text-right = l @user.birthday, format: :long
          - if @user.email
            tr
              th scope='row' = 'Email'
              td.text-right = @user.email
          tr
            th scope='row' = 'Aangemaakt op'
            td.text-right = l @user.created_at, format: :long
          tr
            th scope='row' = 'Accountbron'
            - if @user.provider == 'banana_oauth2'
              td.text-right = link_to 'C.S.V. Alpha', "#{Rails.application.config.x.banana_api_url}/users/#{@user.uid}"
            - else
              td.text-right = @user.provider || 'Handmatig aangemaakt'

      - if current_user.treasurer?
        button.btn.btn-sm.btn-secondary.pull-right role='button' data-toggle='modal' data-target='#new_mutation_modal'
          = fa_icon 'plus', class: 'mr-1'
          = 'Inleggen'

      h2
        span.mr-1 = 'Saldo:'
        span class=('text-danger' if @user.credit <= 0)
          = number_to_currency(@user.credit, unit: '€')

    .col-sm-12.col-md-6.py-2
      .card
        .card-header
          ul.nav.nav-tabs.card-header-tabs role='tablist' id='infoTabs'
            li.nav-item
              a.nav-link.active (id='creditInfo-tab' data-toggle="tab" href="#creditInfo" role="tab"
                aria-controls="creditInfo" aria-selected="true")
                = 'Inleggen'
            li.nav-item
              a.nav-link (id='roleInfo-tab' data-toggle="tab" href="#roleInfo" role="tab"
                aria-controls="roleInfo" aria-selected="false")
                = 'Rollen en rechten'

        .card-body.p-1
          .tab-content.p-2 id='infoTabsContent'
            .tab-pane.show.active id='creditInfo' role='tabpanel' aria-labelledby='creditInfo-tab'
              = content_tag :div, class: "alert mb-1 alert-#{@user.credit <= 0 ? 'danger' : 'info'}"
                h4.alert-heading
                 = @user.credit <= 0 ? 'Je staat rood!' : 'Inleggen'

                p.card-text
                  = 'Om je saldo aan te vullen moet je zelf geld overmaken. '
                  = 'Dat kan naar NL68 INGB 0008 1654 20 t.n.v. Stichting Societeit Flux '
                  = 'onder vermelding van je naam en \'Inleg Zatladder\'.'
                small.mb-0 = 'Het kan enkele dagen duren voor je betaling is verwerkt.'

            .tab-pane.p-2 id='roleInfo' role='tabpanel' aria-labelledby='roleInfo-tab'
              button.btn.btn-small.pull-right (type= 'button' data-toggle= 'collapse'
                data-target= '#roleSyncDescription' aria-controls='roleSyncDescription' aria-expanded='false')
                = fa_icon 'question-circle'

              h2.card-title
                = 'Rollen'

              p.alert.alert-light.card-text.collapse id='roleSyncDescription'
                = 'Rollen worden gesynchroniseerd als de gebruiker zelf inlogt'

              p.card-text.d-none.d-md-block
                = 'Rechten zijn afhankelijk van de rollen die een gebruiker in het streepsysteem heeft. '
                = 'Rollen worden bepaald aan de hand van de groepen waar een gebruiker lid van is in de Alpha website.'

              - if @user.roles_users.any?
                ul.mb-1
                  - @user.roles_users.each do |role|
                    li = role.name
              - else
                p = "#{@user.name} heeft geen speciale rollen binnen het streepsysteem."

  hr

  .col-sm-12
    .row.card
      .card-header
        ul.nav.nav-tabs.card-header-tabs role='tablist' id='userTabs'
          li.nav-item
            a.nav-link.active (id='orders-tab' data-toggle="tab" href="#orders" role="tab"
              aria-controls="orders" aria-selected="true")
              = 'Bestellingen'
          li.nav-item
            a.nav-link (id='creditMutations-tab' data-toggle="tab" href="#creditMutations" role="tab"
              aria-controls="creditMutations" aria-selected="false")
              = 'Inleg en saldocorrecties'

      .card-body
        .tab-content.p-2 id='userTabsContent'
          .tab-pane.show.active id='orders' role='tabpanel' aria-labelledby='orders-tab'
            order-history :user="user"

          .tab-pane id='creditMutations' role='tabpanel' aria-labelledby='creditMutations-tab'
            .table-responsive
              table.table
                thead
                  tr
                    th scope='col'= '#'
                    th scope='col'= 'Datum'
                    th scope='col'= 'Beschrijving'
                    th scope='col'= 'Bedrag'

                tbody
                  - if @user.credit_mutations.empty?
                    tr
                      td.text-center colspan='4'
                        p.my-1
                          em = "#{@user.name} heeft nog niet ingelegd en er zijn nog geen correcties"
                  - else
                    - @user.credit_mutations.each do |mutation|
                      tr
                        th scope='row' = mutation.id
                        td = l mutation.created_at
                        td = mutation.description
                        td = number_to_currency(mutation.amount, unit: '€')
